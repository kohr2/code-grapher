000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. COMPREHENSIVE-PROGRAM.
000300 AUTHOR. DEVELOPER.
000400 DATE-WRITTEN. 2024-01-01.
000500 DATE-COMPILED. 2024-01-01.
000600 SECURITY. NONE.
000700
000800 ENVIRONMENT DIVISION.
000900 CONFIGURATION SECTION.
001000 SOURCE-COMPUTER. IBM-370.
001100 OBJECT-COMPUTER. IBM-370.
001200 SPECIAL-NAMES.
001300     CURRENCY SIGN IS '$'.
001400     DECIMAL-POINT IS COMMA.
001500 INPUT-OUTPUT SECTION.
001600 FILE-CONTROL.
001700     SELECT INPUT-FILE ASSIGN TO INPUT.
001800     SELECT OUTPUT-FILE ASSIGN TO OUTPUT.
001900     SELECT REPORT-FILE ASSIGN TO REPORT.
002000     SELECT ERROR-FILE ASSIGN TO ERROR.
002100     SELECT TEMP-FILE ASSIGN TO TEMP.
002200
002300 DATA DIVISION.
002400 FILE SECTION.
002500 FD INPUT-FILE.
002600 01 INPUT-RECORD.
002700    05 CUSTOMER-ID PIC X(10).
002800    05 CUSTOMER-NAME PIC X(30).
002900    05 BALANCE PIC 9(7)V99.
003000    05 ACCOUNT-TYPE PIC X(1).
003100    05 OPEN-DATE PIC X(8).
003200    05 STATUS-CODE PIC X(1).
003300
003400 FD OUTPUT-FILE.
003500 01 OUTPUT-RECORD.
003600    05 CUSTOMER-ID PIC X(10).
003700    05 CUSTOMER-NAME PIC X(30).
003800    05 BALANCE PIC 9(7)V99.
003900    05 ACCOUNT-TYPE PIC X(1).
004000    05 OPEN-DATE PIC X(8).
004100    05 STATUS-CODE PIC X(1).
004200    05 PROCESSED-DATE PIC X(8).
004300
004400 FD REPORT-FILE.
004500 01 REPORT-RECORD PIC X(80).
004600
004700 FD ERROR-FILE.
004800 01 ERROR-RECORD PIC X(80).
004900
005000 FD TEMP-FILE.
005100 01 TEMP-RECORD PIC X(100).
005200
005300 WORKING-STORAGE SECTION.
005400 01 WS-COUNTERS.
005500    05 WS-RECORD-COUNT PIC 9(5) VALUE ZERO.
005600    05 WS-TOTAL-BALANCE PIC 9(9)V99 VALUE ZERO.
005700    05 WS-AVERAGE-BALANCE PIC 9(7)V99 VALUE ZERO.
005800    05 WS-ERROR-COUNT PIC 9(3) VALUE ZERO.
005900    05 WS-SUCCESS-COUNT PIC 9(5) VALUE ZERO.
006000
006100 01 WS-FLAGS.
006200    05 WS-EOF-FLAG PIC X(1) VALUE 'N'.
006300    05 WS-ERROR-FLAG PIC X(1) VALUE 'N'.
006400    05 WS-FIRST-RECORD PIC X(1) VALUE 'Y'.
006500    05 WS-LAST-RECORD PIC X(1) VALUE 'N'.
006600
006700 01 WS-CALCULATIONS.
006800    05 WS-TEMP-VALUE PIC 9(7)V99.
006900    05 WS-DIVISOR PIC 9(5) VALUE ZERO.
007000    05 WS-MULTIPLIER PIC 9(3) VALUE ZERO.
007100    05 WS-RESULT PIC 9(9)V99 VALUE ZERO.
007200
007300 01 WS-DATE-FIELDS.
007400    05 WS-CURRENT-DATE PIC X(8).
007500    05 WS-CURRENT-TIME PIC X(6).
007600    05 WS-PROCESS-DATE PIC X(8).
007700
007800 01 WS-CONTROL-FIELDS.
007900    05 WS-PREV-CUSTOMER-ID PIC X(10).
008000    05 WS-CURRENT-CUSTOMER-ID PIC X(10).
008100    05 WS-NEXT-CUSTOMER-ID PIC X(10).
008200
008300 PROCEDURE DIVISION.
008400 1000-MAIN-PROCESSING SECTION.
008500 1100-INITIALIZE-PROGRAM.
008600     DISPLAY 'PROGRAM STARTING'.
008700     MOVE ZERO TO WS-RECORD-COUNT.
008800     MOVE ZERO TO WS-TOTAL-BALANCE.
008900     MOVE 'N' TO WS-EOF-FLAG.
009000     MOVE 'N' TO WS-ERROR-FLAG.
009100     PERFORM 2000-OPEN-FILES.
009200     IF WS-ERROR-FLAG = 'Y'
009300         PERFORM 9000-ERROR-HANDLER
009400     ELSE
009500         PERFORM 3000-PROCESS-RECORDS
009600     END-IF.
009700     PERFORM 8000-CLOSE-FILES.
009800     PERFORM 7000-DISPLAY-RESULTS.
009900     STOP RUN.
010000
010100 1200-VALIDATE-INPUT.
010200     IF CUSTOMER-ID = SPACES
010300         MOVE 'Y' TO WS-ERROR-FLAG
010400         DISPLAY 'ERROR: CUSTOMER-ID IS BLANK'
010500     END-IF.
010600     IF CUSTOMER-NAME = SPACES
010700         MOVE 'Y' TO WS-ERROR-FLAG
010800         DISPLAY 'ERROR: CUSTOMER-NAME IS BLANK'
010900     END-IF.
011000     IF BALANCE < ZERO
011100         MOVE 'Y' TO WS-ERROR-FLAG
011200         DISPLAY 'ERROR: BALANCE IS NEGATIVE'
011300     END-IF.
011400
011500 1300-CALCULATE-TOTALS.
011600     ADD BALANCE TO WS-TOTAL-BALANCE.
011700     ADD 1 TO WS-RECORD-COUNT.
011800     IF WS-RECORD-COUNT > ZERO
011900         DIVIDE WS-TOTAL-BALANCE BY WS-RECORD-COUNT
012000             GIVING WS-AVERAGE-BALANCE
012100     END-IF.
012200
012300 1400-UPDATE-COUNTERS.
012400     ADD 1 TO WS-RECORD-COUNT.
012500     ADD BALANCE TO WS-TOTAL-BALANCE.
012600     IF WS-ERROR-FLAG = 'Y'
012700         ADD 1 TO WS-ERROR-COUNT
012800     ELSE
012900         ADD 1 TO WS-SUCCESS-COUNT
013000     END-IF.
013100
013200 1500-RESET-COUNTERS.
013300     MOVE ZERO TO WS-RECORD-COUNT.
013400     MOVE ZERO TO WS-TOTAL-BALANCE.
013500     MOVE ZERO TO WS-ERROR-COUNT.
013600     MOVE ZERO TO WS-SUCCESS-COUNT.
013700
013800 1600-CHECK-LIMITS.
013900     IF WS-RECORD-COUNT > 99999
014000         MOVE 'Y' TO WS-ERROR-FLAG
014100         DISPLAY 'ERROR: RECORD COUNT EXCEEDED LIMIT'
014200     END-IF.
014300     IF WS-TOTAL-BALANCE > 999999999
014400         MOVE 'Y' TO WS-ERROR-FLAG
014500         DISPLAY 'ERROR: TOTAL BALANCE EXCEEDED LIMIT'
014600     END-IF.
014700
014800 1700-VALIDATE-DATA.
014900     IF CUSTOMER-ID = SPACES
015000         MOVE 'Y' TO WS-ERROR-FLAG
015100     END-IF.
015200     IF CUSTOMER-NAME = SPACES
015300         MOVE 'Y' TO WS-ERROR-FLAG
015400     END-IF.
015500     IF BALANCE < ZERO
015600         MOVE 'Y' TO WS-ERROR-FLAG
015700     END-IF.
015800
015900 1800-PROCESS-DATE.
016000     MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE.
016100     MOVE WS-CURRENT-DATE TO WS-PROCESS-DATE.
016200     DISPLAY 'PROCESS DATE: ' WS-PROCESS-DATE.
016300
016400 1900-SET-DEFAULTS.
016500     MOVE 'L' TO STATUS-CODE.
016600     MOVE SPACES TO CUSTOMER-ID.
016700     MOVE SPACES TO CUSTOMER-NAME.
016800     MOVE ZERO TO BALANCE.
016900
017000 2000-FILE-OPERATIONS SECTION.
017100 2100-OPEN-FILES.
017200     OPEN INPUT INPUT-FILE.
017300     IF FILE-STATUS NOT = '00'
017400         MOVE 'Y' TO WS-ERROR-FLAG
017500         DISPLAY 'ERROR OPENING INPUT FILE'
017600     END-IF.
017700     OPEN OUTPUT OUTPUT-FILE.
017800     IF FILE-STATUS NOT = '00'
017900         MOVE 'Y' TO WS-ERROR-FLAG
018000         DISPLAY 'ERROR OPENING OUTPUT FILE'
018100     END-IF.
018200     OPEN OUTPUT REPORT-FILE.
018300     IF FILE-STATUS NOT = '00'
018400         MOVE 'Y' TO WS-ERROR-FLAG
018500         DISPLAY 'ERROR OPENING REPORT FILE'
018600     END-IF.
018700     OPEN OUTPUT ERROR-FILE.
018800     IF FILE-STATUS NOT = '00'
018900         MOVE 'Y' TO WS-ERROR-FLAG
019000         DISPLAY 'ERROR OPENING ERROR FILE'
019100     END-IF.
019200
019300 2200-READ-RECORD.
019400     READ INPUT-FILE INTO INPUT-RECORD.
019500     IF FILE-STATUS = '10'
019600         MOVE 'Y' TO WS-EOF-FLAG
019700     ELSE IF FILE-STATUS NOT = '00'
019800         MOVE 'Y' TO WS-ERROR-FLAG
019900         DISPLAY 'ERROR READING INPUT FILE'
020000     END-IF.
020100
020200 2300-WRITE-RECORD.
020300     WRITE OUTPUT-RECORD FROM INPUT-RECORD.
020400     IF FILE-STATUS NOT = '00'
020500         MOVE 'Y' TO WS-ERROR-FLAG
020600         DISPLAY 'ERROR WRITING OUTPUT FILE'
020700     END-IF.
020800
020900 2400-WRITE-REPORT.
021000     WRITE REPORT-RECORD FROM WS-COUNTERS.
021100     IF FILE-STATUS NOT = '00'
021200         MOVE 'Y' TO WS-ERROR-FLAG
021300         DISPLAY 'ERROR WRITING REPORT FILE'
021400     END-IF.
021500
021600 2500-WRITE-ERROR.
021700     WRITE ERROR-RECORD FROM INPUT-RECORD.
021800     IF FILE-STATUS NOT = '00'
021900         MOVE 'Y' TO WS-ERROR-FLAG
022000         DISPLAY 'ERROR WRITING ERROR FILE'
022100     END-IF.
022200
022300 2600-CLOSE-FILES.
022400     CLOSE INPUT-FILE.
022500     CLOSE OUTPUT-FILE.
022600     CLOSE REPORT-FILE.
022700     CLOSE ERROR-FILE.
022800
022900 2700-BACKUP-FILES.
023000     OPEN OUTPUT TEMP-FILE.
023100     IF FILE-STATUS NOT = '00'
023200         MOVE 'Y' TO WS-ERROR-FLAG
023300         DISPLAY 'ERROR OPENING TEMP FILE'
023400     END-IF.
023500     CLOSE TEMP-FILE.
023600
023700 2800-VERIFY-FILES.
023800     DISPLAY 'VERIFYING FILE STATUS'.
023900     DISPLAY 'INPUT FILE STATUS: ' FILE-STATUS.
024000     DISPLAY 'OUTPUT FILE STATUS: ' FILE-STATUS.
024100
024200 2900-CLEANUP-FILES.
024300     DISPLAY 'CLEANING UP TEMPORARY FILES'.
024400     DELETE TEMP-FILE.
024500     IF FILE-STATUS NOT = '00'
024600         DISPLAY 'WARNING: COULD NOT DELETE TEMP FILE'
024700     END-IF.
024800
025000 3000-DATA-PROCESSING SECTION.
025100 3100-PROCESS-RECORDS.
025200     PERFORM 2200-READ-RECORD.
025300     PERFORM UNTIL WS-EOF-FLAG = 'Y'
025400         PERFORM 3200-PROCESS-SINGLE-RECORD
025500         PERFORM 2200-READ-RECORD
025600     END-PERFORM.
025700
025800 3200-PROCESS-SINGLE-RECORD.
025900     PERFORM 1200-VALIDATE-INPUT.
026000     IF WS-ERROR-FLAG = 'N'
026100         PERFORM 3300-TRANSFORM-DATA
026200         PERFORM 1300-CALCULATE-TOTALS
026300         PERFORM 2300-WRITE-RECORD
026400     ELSE
026500         PERFORM 2500-WRITE-ERROR
026600         PERFORM 9000-ERROR-HANDLER
026700     END-IF.
026800
026900 3300-TRANSFORM-DATA.
027000     MOVE CUSTOMER-ID TO CUSTOMER-ID OF OUTPUT-RECORD.
027100     MOVE CUSTOMER-NAME TO CUSTOMER-NAME OF OUTPUT-RECORD.
027200     MOVE BALANCE TO BALANCE OF OUTPUT-RECORD.
027300     MOVE ACCOUNT-TYPE TO ACCOUNT-TYPE OF OUTPUT-RECORD.
027400     MOVE OPEN-DATE TO OPEN-DATE OF OUTPUT-RECORD.
027500     MOVE WS-PROCESS-DATE TO PROCESSED-DATE OF OUTPUT-RECORD.
027600     IF BALANCE > 10000
027700         MOVE 'H' TO STATUS-CODE OF OUTPUT-RECORD
027800     ELSE IF BALANCE > 5000
027900         MOVE 'M' TO STATUS-CODE OF OUTPUT-RECORD
028000     ELSE
028100         MOVE 'L' TO STATUS-CODE OF OUTPUT-RECORD
028200     END-IF.
028300
028400 3400-BATCH-PROCESSING.
028500     PERFORM 3100-PROCESS-RECORDS.
028600     PERFORM 3500-GENERATE-SUMMARY.
028700
028800 3500-GENERATE-SUMMARY.
028900     DISPLAY 'TOTAL RECORDS PROCESSED: ' WS-RECORD-COUNT.
029000     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
029100     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
029200     DISPLAY 'ERROR COUNT: ' WS-ERROR-COUNT.
029300     DISPLAY 'SUCCESS COUNT: ' WS-SUCCESS-COUNT.
029400
029500 3600-CALCULATE-STATISTICS.
029600     COMPUTE WS-AVERAGE-BALANCE = WS-TOTAL-BALANCE / WS-RECORD-COUNT.
029700     IF WS-RECORD-COUNT > ZERO
029800         DIVIDE WS-TOTAL-BALANCE BY WS-RECORD-COUNT
029900             GIVING WS-AVERAGE-BALANCE
030000             REMAINDER WS-TEMP-VALUE
030100     END-IF.
030200
030300 3700-UPDATE-STATUS.
030400     IF WS-ERROR-COUNT > WS-SUCCESS-COUNT
030500         MOVE 'Y' TO WS-ERROR-FLAG
030600         DISPLAY 'WARNING: MORE ERRORS THAN SUCCESSES'
030700     END-IF.
030800
030900 3800-VALIDATE-RESULTS.
031000     IF WS-RECORD-COUNT = ZERO
031100         DISPLAY 'WARNING: NO RECORDS PROCESSED'
031200     END-IF.
031300     IF WS-TOTAL-BALANCE = ZERO
031400         DISPLAY 'WARNING: TOTAL BALANCE IS ZERO'
031500     END-IF.
031600
031700 3900-FINALIZE-PROCESSING.
031800     PERFORM 3600-CALCULATE-STATISTICS.
031900     PERFORM 3700-UPDATE-STATUS.
032000     PERFORM 3800-VALIDATE-RESULTS.
032100
032200 4000-VALIDATION SECTION.
032300 4100-VALIDATE-CUSTOMER-DATA.
032400     IF CUSTOMER-ID = SPACES
032500         MOVE 'Y' TO WS-ERROR-FLAG
032600     END-IF.
032700     IF CUSTOMER-NAME = SPACES
032800         MOVE 'Y' TO WS-ERROR-FLAG
032900     END-IF.
033000
033100 4200-VALIDATE-BALANCE.
033200     IF BALANCE < ZERO
033300         MOVE 'Y' TO WS-ERROR-FLAG
033400     END-IF.
033500     IF BALANCE > 999999999
033600         MOVE 'Y' TO WS-ERROR-FLAG
033700     END-IF.
033800
033900 4300-VALIDATE-FILE-STATUS.
034000     IF FILE-STATUS NOT = '00' AND FILE-STATUS NOT = '10'
034100         MOVE 'Y' TO WS-ERROR-FLAG
034200     END-IF.
034300
034400 4400-VALIDATE-ACCOUNT-TYPE.
034500     IF ACCOUNT-TYPE NOT = 'S' AND ACCOUNT-TYPE NOT = 'C'
034600         MOVE 'Y' TO WS-ERROR-FLAG
034700         DISPLAY 'ERROR: INVALID ACCOUNT TYPE'
034800     END-IF.
034900
035000 4500-VALIDATE-DATE.
035100     IF OPEN-DATE = SPACES
035200         MOVE 'Y' TO WS-ERROR-FLAG
035300         DISPLAY 'ERROR: OPEN DATE IS BLANK'
035400     END-IF.
035500
035600 4600-VALIDATE-STATUS.
035700     IF STATUS-CODE NOT = 'A' AND STATUS-CODE NOT = 'I'
035800         MOVE 'Y' TO WS-ERROR-FLAG
035900         DISPLAY 'ERROR: INVALID STATUS CODE'
036000     END-IF.
036100
036200 4700-COMPREHENSIVE-VALIDATION.
036300     PERFORM 4100-VALIDATE-CUSTOMER-DATA.
036400     PERFORM 4200-VALIDATE-BALANCE.
036500     PERFORM 4300-VALIDATE-FILE-STATUS.
036600     PERFORM 4400-VALIDATE-ACCOUNT-TYPE.
036700     PERFORM 4500-VALIDATE-DATE.
036800     PERFORM 4600-VALIDATE-STATUS.
036900
037000 4800-VALIDATION-SUMMARY.
037100     IF WS-ERROR-FLAG = 'Y'
037200         DISPLAY 'VALIDATION FAILED'
037300     ELSE
037400         DISPLAY 'VALIDATION PASSED'
037500     END-IF.
037600
037700 4900-RESET-VALIDATION-FLAGS.
037800     MOVE 'N' TO WS-ERROR-FLAG.
037900     MOVE ZERO TO WS-ERROR-COUNT.
038000
038100 5000-REPORTING SECTION.
038200 5100-GENERATE-REPORT.
038300     DISPLAY '=== CUSTOMER PROCESSING REPORT ==='.
038400     DISPLAY 'PROGRAM: COMPREHENSIVE-PROGRAM'.
038500     DISPLAY 'DATE: ' FUNCTION CURRENT-DATE.
038600     DISPLAY 'RECORDS PROCESSED: ' WS-RECORD-COUNT.
038700     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
038800     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
038900     DISPLAY 'ERROR COUNT: ' WS-ERROR-COUNT.
039000     DISPLAY 'SUCCESS COUNT: ' WS-SUCCESS-COUNT.
039100
039200 5200-DISPLAY-ERRORS.
039300     IF WS-ERROR-FLAG = 'Y'
039400         DISPLAY 'ERRORS OCCURRED DURING PROCESSING'
039500     ELSE
039600         DISPLAY 'PROCESSING COMPLETED SUCCESSFULLY'
039700     END-IF.
039800
039900 5300-FORMAT-OUTPUT.
040000     MOVE WS-RECORD-COUNT TO WS-TEMP-VALUE.
040100     DISPLAY 'FORMATTED RECORD COUNT: ' WS-TEMP-VALUE.
040200     MOVE WS-TOTAL-BALANCE TO WS-TEMP-VALUE.
040300     DISPLAY 'FORMATTED TOTAL BALANCE: ' WS-TEMP-VALUE.
040400     MOVE WS-AVERAGE-BALANCE TO WS-TEMP-VALUE.
040500     DISPLAY 'FORMATTED AVERAGE BALANCE: ' WS-TEMP-VALUE.
040600
041000 5400-GENERATE-DETAIL-REPORT.
041100     DISPLAY 'DETAIL REPORT GENERATION'.
041200     DISPLAY 'CUSTOMER ID: ' CUSTOMER-ID.
041300     DISPLAY 'CUSTOMER NAME: ' CUSTOMER-NAME.
041400     DISPLAY 'BALANCE: ' BALANCE.
041500     DISPLAY 'ACCOUNT TYPE: ' ACCOUNT-TYPE.
041600     DISPLAY 'OPEN DATE: ' OPEN-DATE.
041700     DISPLAY 'STATUS CODE: ' STATUS-CODE.
041800
041900 5500-GENERATE-SUMMARY-REPORT.
042000     DISPLAY 'SUMMARY REPORT GENERATION'.
042100     DISPLAY 'TOTAL RECORDS: ' WS-RECORD-COUNT.
042200     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
042300     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
042400     DISPLAY 'ERROR RATE: ' WS-ERROR-COUNT.
042500     DISPLAY 'SUCCESS RATE: ' WS-SUCCESS-COUNT.
042600
043000 5600-PRINT-REPORT.
043100     WRITE REPORT-RECORD FROM WS-COUNTERS.
043200     IF FILE-STATUS NOT = '00'
043300         MOVE 'Y' TO WS-ERROR-FLAG
043400         DISPLAY 'ERROR WRITING REPORT'
043500     END-IF.
043600
043700 5700-FORMAT-REPORT-LINE.
043800     MOVE SPACES TO REPORT-RECORD.
043900     STRING 'RECORD: ' DELIMITED BY SIZE
044000            WS-RECORD-COUNT DELIMITED BY SIZE
044100            ' BALANCE: ' DELIMITED BY SIZE
044200            WS-TOTAL-BALANCE DELIMITED BY SIZE
044300            INTO REPORT-RECORD.
044400
044500 5800-WRITE-REPORT-HEADER.
044600     MOVE 'CUSTOMER PROCESSING REPORT' TO REPORT-RECORD.
044700     WRITE REPORT-RECORD.
044800     MOVE '=============================' TO REPORT-RECORD.
044900     WRITE REPORT-RECORD.
045000
045100 5900-WRITE-REPORT-FOOTER.
046000     MOVE 'END OF REPORT' TO REPORT-RECORD.
046100     WRITE REPORT-RECORD.
046200
046300 6000-UTILITY SECTION.
046400 6100-CLEAR-WORKING-STORAGE.
046500     MOVE ZERO TO WS-RECORD-COUNT.
046600     MOVE ZERO TO WS-TOTAL-BALANCE.
046700     MOVE ZERO TO WS-AVERAGE-BALANCE.
046800     MOVE ZERO TO WS-ERROR-COUNT.
046900     MOVE ZERO TO WS-SUCCESS-COUNT.
047000     MOVE 'N' TO WS-EOF-FLAG.
047100     MOVE 'N' TO WS-ERROR-FLAG.
047200
047300 6200-INITIALIZE-COUNTERS.
047400     MOVE ZERO TO WS-RECORD-COUNT.
047500     MOVE ZERO TO WS-TOTAL-BALANCE.
047600     MOVE ZERO TO WS-AVERAGE-BALANCE.
047700     MOVE ZERO TO WS-ERROR-COUNT.
047800     MOVE ZERO TO WS-SUCCESS-COUNT.
047900
048000 6300-RESET-FLAGS.
049000     MOVE 'N' TO WS-EOF-FLAG.
049100     MOVE 'N' TO WS-ERROR-FLAG.
049200     MOVE 'Y' TO WS-FIRST-RECORD.
049300     MOVE 'N' TO WS-LAST-RECORD.
049400
049500 6400-SET-DEFAULTS.
050000     MOVE 'L' TO STATUS-CODE.
050100     MOVE SPACES TO CUSTOMER-ID.
050200     MOVE SPACES TO CUSTOMER-NAME.
050300     MOVE ZERO TO BALANCE.
050400     MOVE 'S' TO ACCOUNT-TYPE.
050500     MOVE SPACES TO OPEN-DATE.
050600
050700 6500-INITIALIZE-DATE-FIELDS.
050800     MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE.
050900     MOVE WS-CURRENT-DATE TO WS-PROCESS-DATE.
051000     MOVE FUNCTION CURRENT-TIME TO WS-CURRENT-TIME.
051100
051200 6600-SET-CONTROL-FIELDS.
051300     MOVE CUSTOMER-ID TO WS-CURRENT-CUSTOMER-ID.
051400     MOVE WS-CURRENT-CUSTOMER-ID TO WS-PREV-CUSTOMER-ID.
051500
051600 6700-UPDATE-CONTROL-FIELDS.
051700     MOVE WS-CURRENT-CUSTOMER-ID TO WS-PREV-CUSTOMER-ID.
051800     MOVE CUSTOMER-ID TO WS-CURRENT-CUSTOMER-ID.
051900
052000 6800-CHECK-CONTROL-BREAK.
052100     IF WS-CURRENT-CUSTOMER-ID NOT = WS-PREV-CUSTOMER-ID
052200         PERFORM 6900-PROCESS-CONTROL-BREAK
052300     END-IF.
052400
052500 6900-PROCESS-CONTROL-BREAK.
052600     DISPLAY 'CONTROL BREAK DETECTED'.
052700     DISPLAY 'PREVIOUS CUSTOMER: ' WS-PREV-CUSTOMER-ID.
052800     DISPLAY 'CURRENT CUSTOMER: ' WS-CURRENT-CUSTOMER-ID.
052900
053000 7000-DISPLAY-RESULTS.
053100     DISPLAY 'PROGRAM COMPLETED'.
053200     DISPLAY 'FINAL RECORD COUNT: ' WS-RECORD-COUNT.
053300     DISPLAY 'FINAL TOTAL BALANCE: ' WS-TOTAL-BALANCE.
053400     DISPLAY 'FINAL AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
053500     DISPLAY 'FINAL ERROR COUNT: ' WS-ERROR-COUNT.
053600     DISPLAY 'FINAL SUCCESS COUNT: ' WS-SUCCESS-COUNT.
053700
053800 7100-DISPLAY-SUMMARY.
053900     DISPLAY 'PROCESSING SUMMARY'.
054000     DISPLAY 'TOTAL RECORDS: ' WS-RECORD-COUNT.
054100     DISPLAY 'SUCCESSFUL RECORDS: ' WS-SUCCESS-COUNT.
054200     DISPLAY 'ERROR RECORDS: ' WS-ERROR-COUNT.
054300     DISPLAY 'SUCCESS RATE: ' WS-SUCCESS-COUNT.
054400
054500 7200-DISPLAY-STATISTICS.
054600     DISPLAY 'STATISTICAL SUMMARY'.
054700     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
054800     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
054900     DISPLAY 'RECORD COUNT: ' WS-RECORD-COUNT.
055000
055100 7300-DISPLAY-PERFORMANCE.
055200     DISPLAY 'PERFORMANCE METRICS'.
055300     DISPLAY 'PROCESSING TIME: CALCULATED'.
055400     DISPLAY 'MEMORY USAGE: MONITORED'.
055500     DISPLAY 'CPU USAGE: MONITORED'.
055600
055700 7400-DISPLAY-STATUS.
055800     DISPLAY 'PROGRAM STATUS'.
055900     DISPLAY 'ERROR FLAG: ' WS-ERROR-FLAG.
056000     DISPLAY 'EOF FLAG: ' WS-EOF-FLAG.
056100     DISPLAY 'FIRST RECORD: ' WS-FIRST-RECORD.
056200     DISPLAY 'LAST RECORD: ' WS-LAST-RECORD.
056300
056400 7500-DISPLAY-CONFIGURATION.
056500     DISPLAY 'SYSTEM CONFIGURATION'.
056600     DISPLAY 'SOURCE COMPUTER: IBM-370'.
056700     DISPLAY 'OBJECT COMPUTER: IBM-370'.
056800     DISPLAY 'CURRENCY SIGN: $'.
056900     DISPLAY 'DECIMAL POINT: COMMA'.
057000
057100 7600-DISPLAY-FILE-STATUS.
057200     DISPLAY 'FILE STATUS INFORMATION'.
057300     DISPLAY 'INPUT FILE STATUS: ' FILE-STATUS.
057400     DISPLAY 'OUTPUT FILE STATUS: ' FILE-STATUS.
057500     DISPLAY 'REPORT FILE STATUS: ' FILE-STATUS.
057600     DISPLAY 'ERROR FILE STATUS: ' FILE-STATUS.
057700
057800 7700-DISPLAY-DATA-FIELDS.
057900     DISPLAY 'DATA FIELD VALUES'.
058000     DISPLAY 'CUSTOMER ID: ' CUSTOMER-ID.
058100     DISPLAY 'CUSTOMER NAME: ' CUSTOMER-NAME.
058200     DISPLAY 'BALANCE: ' BALANCE.
058300     DISPLAY 'ACCOUNT TYPE: ' ACCOUNT-TYPE.
058400     DISPLAY 'OPEN DATE: ' OPEN-DATE.
058500     DISPLAY 'STATUS CODE: ' STATUS-CODE.
058600
057800 7800-DISPLAY-WORKING-STORAGE.
058900     DISPLAY 'WORKING STORAGE VALUES'.
059000     DISPLAY 'RECORD COUNT: ' WS-RECORD-COUNT.
059100     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
059200     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
059300     DISPLAY 'ERROR COUNT: ' WS-ERROR-COUNT.
059400     DISPLAY 'SUCCESS COUNT: ' WS-SUCCESS-COUNT.
059500
059600 7900-DISPLAY-CONTROL-FIELDS.
059700     DISPLAY 'CONTROL FIELD VALUES'.
059800     DISPLAY 'PREVIOUS CUSTOMER: ' WS-PREV-CUSTOMER-ID.
059900     DISPLAY 'CURRENT CUSTOMER: ' WS-CURRENT-CUSTOMER-ID.
060000     DISPLAY 'NEXT CUSTOMER: ' WS-NEXT-CUSTOMER-ID.
060100
060200 8000-CLOSE-FILES.
060300     CLOSE INPUT-FILE.
060400     CLOSE OUTPUT-FILE.
060500     CLOSE REPORT-FILE.
060600     CLOSE ERROR-FILE.
060700
060800 8100-VERIFY-CLOSE.
060800     DISPLAY 'VERIFYING FILE CLOSURE'.
060900     DISPLAY 'ALL FILES CLOSED SUCCESSFULLY'.
061000
061100 8200-CLEANUP-ON-CLOSE.
061100     DISPLAY 'CLEANING UP ON CLOSE'.
061200     PERFORM 6100-CLEAR-WORKING-STORAGE.
061300
061400 8300-FINAL-CLOSE.
061400     DISPLAY 'FINAL CLOSE OPERATIONS'.
061500     CLOSE TEMP-FILE.
061600     DELETE TEMP-FILE.
061700
061800 8400-CLOSE-VALIDATION.
061800     DISPLAY 'CLOSE VALIDATION'.
061900     IF FILE-STATUS NOT = '00'
062000         DISPLAY 'WARNING: FILE CLOSE ISSUE'
062100     END-IF.
062200
062300 8500-CLOSE-REPORTING.
062300     DISPLAY 'CLOSE REPORTING'.
062400     DISPLAY 'FILES CLOSED: INPUT, OUTPUT, REPORT, ERROR'.
062500
062600 8600-CLOSE-SUMMARY.
062600     DISPLAY 'CLOSE SUMMARY'.
062700     DISPLAY 'ALL OPERATIONS COMPLETED'.
062800
062900 8700-CLOSE-CLEANUP.
062900     DISPLAY 'CLOSE CLEANUP'.
063000     PERFORM 6100-CLEAR-WORKING-STORAGE.
063100     PERFORM 6300-RESET-FLAGS.
063200
063300 8800-CLOSE-FINALIZATION.
063300     DISPLAY 'CLOSE FINALIZATION'.
063400     DISPLAY 'PROGRAM READY FOR TERMINATION'.
063500
063600 8900-CLOSE-VERIFICATION.
063600     DISPLAY 'CLOSE VERIFICATION'.
063700     DISPLAY 'ALL FILES PROPERLY CLOSED'.
063800
063900 9000-ERROR-HANDLER.
064000     DISPLAY 'ERROR OCCURRED IN PROGRAM'.
064100     DISPLAY 'ERROR FLAG: ' WS-ERROR-FLAG.
064200     DISPLAY 'EOF FLAG: ' WS-EOF-FLAG.
064300     DISPLAY 'RECORD COUNT: ' WS-RECORD-COUNT.
064400     DISPLAY 'ERROR COUNT: ' WS-ERROR-COUNT.
064500
064600 9100-LOG-ERROR.
064700     DISPLAY 'ERROR LOGGED'.
064800     DISPLAY 'ERROR TYPE: FILE OPERATION'.
064900     DISPLAY 'ERROR TIME: ' FUNCTION CURRENT-DATE.
065000     WRITE ERROR-RECORD FROM INPUT-RECORD.
065100
065200 9200-RECOVERY-PROCEDURE.
065300     MOVE 'N' TO WS-ERROR-FLAG.
065400     PERFORM 6100-CLEAR-WORKING-STORAGE.
065500     DISPLAY 'RECOVERY PROCEDURE COMPLETED'.
065600
065700 9300-CLEANUP-ON-ERROR.
065800     PERFORM 8000-CLOSE-FILES.
065900     PERFORM 6100-CLEAR-WORKING-STORAGE.
066000     DISPLAY 'CLEANUP COMPLETED'.
066100
066200 9400-EXIT-PROGRAM.
066300     DISPLAY 'EXITING PROGRAM'.
066400     STOP RUN.
066500
066600 9500-FINAL-VALIDATION.
066700     IF WS-RECORD-COUNT = ZERO
066800         DISPLAY 'WARNING: NO RECORDS PROCESSED'
066900     END-IF.
067000     IF WS-TOTAL-BALANCE = ZERO
067100         DISPLAY 'WARNING: TOTAL BALANCE IS ZERO'
067200     END-IF.
067300     IF WS-ERROR-COUNT > WS-SUCCESS-COUNT
067400         DISPLAY 'WARNING: MORE ERRORS THAN SUCCESSES'
067500     END-IF.
067600
067700 9600-PERFORMANCE-METRICS.
067800     DISPLAY 'PERFORMANCE METRICS:'.
067900     DISPLAY 'RECORDS PER SECOND: CALCULATED'.
068000     DISPLAY 'MEMORY USAGE: MONITORED'.
068100     DISPLAY 'CPU USAGE: MONITORED'.
068200     DISPLAY 'DISK USAGE: MONITORED'.
068300
068400 9700-SYSTEM-STATUS.
068500     DISPLAY 'SYSTEM STATUS CHECK'.
068600     DISPLAY 'FILE STATUS: ' FILE-STATUS.
068700     DISPLAY 'PROGRAM STATUS: ACTIVE'.
068800     DISPLAY 'MEMORY STATUS: AVAILABLE'.
068900     DISPLAY 'CPU STATUS: NORMAL'.
069000
069100 9800-MAINTENANCE-MODE.
069200     DISPLAY 'ENTERING MAINTENANCE MODE'.
069300     DISPLAY 'PERFORMING SYSTEM CHECKS'.
069400     DISPLAY 'CHECKING FILE INTEGRITY'.
069500     DISPLAY 'CHECKING DATA CONSISTENCY'.
069600     DISPLAY 'MAINTENANCE COMPLETED'.
069700
069800 9900-SHUTDOWN-PROCEDURE.
069900     DISPLAY 'INITIATING SHUTDOWN'.
070000     PERFORM 8000-CLOSE-FILES.
070100     PERFORM 6100-CLEAR-WORKING-STORAGE.
070200     DISPLAY 'SHUTDOWN COMPLETED'.
070300     STOP RUN.
070400
070500 9910-EMERGENCY-SHUTDOWN.
070600     DISPLAY 'EMERGENCY SHUTDOWN INITIATED'.
070700     PERFORM 9300-CLEANUP-ON-ERROR.
070800     DISPLAY 'EMERGENCY SHUTDOWN COMPLETED'.
070900     STOP RUN.
071000
071100 9920-GRACEFUL-SHUTDOWN.
071200     DISPLAY 'GRACEFUL SHUTDOWN INITIATED'.
071300     PERFORM 8000-CLOSE-FILES.
071400     PERFORM 6100-CLEAR-WORKING-STORAGE.
071500     PERFORM 6300-RESET-FLAGS.
071600     DISPLAY 'GRACEFUL SHUTDOWN COMPLETED'.
071700     STOP RUN.
071800
071900 9930-FORCED-SHUTDOWN.
071800     DISPLAY 'FORCED SHUTDOWN INITIATED'.
071900     PERFORM 9300-CLEANUP-ON-ERROR.
072000     DISPLAY 'FORCED SHUTDOWN COMPLETED'.
072100     STOP RUN.
072200
072300 9940-CONTROLLED-SHUTDOWN.
072300     DISPLAY 'CONTROLLED SHUTDOWN INITIATED'.
072400     PERFORM 8000-CLOSE-FILES.
072500     PERFORM 6100-CLEAR-WORKING-STORAGE.
072600     PERFORM 6300-RESET-FLAGS.
072700     PERFORM 7000-DISPLAY-RESULTS.
072800     DISPLAY 'CONTROLLED SHUTDOWN COMPLETED'.
072900     STOP RUN.
073000
073100 9950-FINAL-SHUTDOWN.
073100     DISPLAY 'FINAL SHUTDOWN INITIATED'.
073200     PERFORM 8000-CLOSE-FILES.
073300     PERFORM 6100-CLEAR-WORKING-STORAGE.
073400     PERFORM 6300-RESET-FLAGS.
073500     PERFORM 7000-DISPLAY-RESULTS.
073600     PERFORM 9500-FINAL-VALIDATION.
073700     DISPLAY 'FINAL SHUTDOWN COMPLETED'.
073800     STOP RUN.
073900
074000 9960-COMPLETE-SHUTDOWN.
074000     DISPLAY 'COMPLETE SHUTDOWN INITIATED'.
074100     PERFORM 8000-CLOSE-FILES.
074200     PERFORM 6100-CLEAR-WORKING-STORAGE.
074300     PERFORM 6300-RESET-FLAGS.
074400     PERFORM 7000-DISPLAY-RESULTS.
074500     PERFORM 9500-FINAL-VALIDATION.
074600     PERFORM 9600-PERFORMANCE-METRICS.
074700     DISPLAY 'COMPLETE SHUTDOWN COMPLETED'.
074800     STOP RUN.
074900
075000 9970-TERMINAL-SHUTDOWN.
075000     DISPLAY 'TERMINAL SHUTDOWN INITIATED'.
075100     PERFORM 8000-CLOSE-FILES.
075200     PERFORM 6100-CLEAR-WORKING-STORAGE.
075300     PERFORM 6300-RESET-FLAGS.
075400     PERFORM 7000-DISPLAY-RESULTS.
075500     PERFORM 9500-FINAL-VALIDATION.
075600     PERFORM 9600-PERFORMANCE-METRICS.
075700     PERFORM 9700-SYSTEM-STATUS.
075800     DISPLAY 'TERMINAL SHUTDOWN COMPLETED'.
075900     STOP RUN.
076000
076100 9980-ABSOLUTE-SHUTDOWN.
076100     DISPLAY 'ABSOLUTE SHUTDOWN INITIATED'.
076200     PERFORM 8000-CLOSE-FILES.
076300     PERFORM 6100-CLEAR-WORKING-STORAGE.
076400     PERFORM 6300-RESET-FLAGS.
076500     PERFORM 7000-DISPLAY-RESULTS.
076600     PERFORM 9500-FINAL-VALIDATION.
076700     PERFORM 9600-PERFORMANCE-METRICS.
076800     PERFORM 9700-SYSTEM-STATUS.
076900     PERFORM 9800-MAINTENANCE-MODE.
077000     DISPLAY 'ABSOLUTE SHUTDOWN COMPLETED'.
077100     STOP RUN.
077200
077300 9990-ULTIMATE-SHUTDOWN.
077300     DISPLAY 'ULTIMATE SHUTDOWN INITIATED'.
077400     PERFORM 8000-CLOSE-FILES.
077500     PERFORM 6100-CLEAR-WORKING-STORAGE.
077600     PERFORM 6300-RESET-FLAGS.
077700     PERFORM 7000-DISPLAY-RESULTS.
077800     PERFORM 9500-FINAL-VALIDATION.
077900     PERFORM 9600-PERFORMANCE-METRICS.
078000     PERFORM 9700-SYSTEM-STATUS.
078100     PERFORM 9800-MAINTENANCE-MODE.
078200     PERFORM 9900-SHUTDOWN-PROCEDURE.
078300     DISPLAY 'ULTIMATE SHUTDOWN COMPLETED'.
078400     STOP RUN.
078500
078600 9999-END-OF-PROGRAM.
078600     DISPLAY 'END OF PROGRAM REACHED'.
078700     PERFORM 8000-CLOSE-FILES.
078800     PERFORM 6100-CLEAR-WORKING-STORAGE.
078900     PERFORM 6300-RESET-FLAGS.
079000     PERFORM 7000-DISPLAY-RESULTS.
079100     PERFORM 9500-FINAL-VALIDATION.
079200     PERFORM 9600-PERFORMANCE-METRICS.
079300     PERFORM 9700-SYSTEM-STATUS.
079400     PERFORM 9800-MAINTENANCE-MODE.
079500     PERFORM 9900-SHUTDOWN-PROCEDURE.
079600     PERFORM 9910-EMERGENCY-SHUTDOWN.
079700     DISPLAY 'END OF PROGRAM COMPLETED'.
079800     STOP RUN.