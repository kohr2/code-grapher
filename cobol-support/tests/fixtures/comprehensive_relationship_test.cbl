       IDENTIFICATION DIVISION.
       PROGRAM-ID. COMPREHENSIVE-RELATIONSHIP-TEST.
       AUTHOR. TEST-AUTHOR.
       DATE-WRITTEN. 2025-01-27.
       SECURITY. TEST-SECURITY.
       
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. TEST-COMPUTER.
       OBJECT-COMPUTER. TEST-COMPUTER.
       
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT ACCOUNT-FILE ASSIGN TO "ACCOUNT.DAT"
           ORGANIZATION IS SEQUENTIAL
           ACCESS MODE IS SEQUENTIAL
           FILE STATUS IS WS-FILE-STATUS.
           
           SELECT REPORT-FILE ASSIGN TO "REPORT.DAT"
           ORGANIZATION IS SEQUENTIAL
           ACCESS MODE IS SEQUENTIAL
           FILE STATUS IS WS-REPORT-STATUS.
       
       DATA DIVISION.
       FILE SECTION.
       FD  ACCOUNT-FILE.
       01  ACCOUNT-RECORD.
           05  ACCOUNT-NUMBER     PIC 9(10).
           05  CUSTOMER-NAME      PIC X(30).
           05  ACCOUNT-BALANCE    PIC 9(8)V99.
           05  ACCOUNT-TYPE       PIC X(1).
       
       FD  REPORT-FILE.
       01  REPORT-RECORD.
           05  REPORT-LINE        PIC X(80).
       
       WORKING-STORAGE SECTION.
       01  WS-CONTROL-FIELDS.
           05  WS-EOF-FLAG        PIC X(1) VALUE 'N'.
           05  WS-RECORD-COUNT    PIC 9(5) VALUE ZERO.
           05  WS-TOTAL-BALANCE   PIC 9(10)V99 VALUE ZERO.
           05  WS-AVERAGE-BALANCE PIC 9(8)V99 VALUE ZERO.
       
       01  WS-ACCOUNT-DATA.
           05  WS-ACCOUNT-NUM     PIC 9(10).
           05  WS-CUSTOMER-NAME   PIC X(30).
           05  WS-BALANCE         PIC 9(8)V99.
           05  WS-ACCOUNT-TYPE    PIC X(1).
       
       01  WS-CALCULATION-FIELDS.
           05  WS-INTEREST-RATE   PIC 9(3)V99 VALUE 5.50.
           05  WS-INTEREST-AMOUNT PIC 9(8)V99.
           05  WS-NEW-BALANCE     PIC 9(8)V99.
           05  WS-RISK-SCORE      PIC 9(3).
       
       01  WS-ERROR-FIELDS.
           05  WS-ERROR-CODE      PIC 9(3).
           05  WS-ERROR-MESSAGE   PIC X(50).
       
       01  WS-SCREEN-FIELDS.
           05  WS-INPUT-FIELD     PIC X(20).
           05  WS-OUTPUT-FIELD    PIC X(20).
           05  WS-DISPLAY-MESSAGE PIC X(50).
       
       01  WS-QUEUE-FIELDS.
           05  WS-QUEUE-NAME      PIC X(20).
           05  WS-QUEUE-DATA      PIC X(100).
       
       SCREEN SECTION.
       01  MAIN-SCREEN.
           05  VALUE "ACCOUNT MANAGEMENT SYSTEM" 
               LINE 1 COL 20.
           05  VALUE "ENTER ACCOUNT NUMBER:" 
               LINE 3 COL 5.
           05  WS-INPUT-FIELD 
               LINE 3 COL 30.
           05  VALUE "BALANCE:" 
               LINE 5 COL 5.
           05  WS-OUTPUT-FIELD 
               LINE 5 COL 15.
       
       01  ERROR-SCREEN.
           05  VALUE "ERROR OCCURRED" 
               LINE 10 COL 20.
           05  WS-ERROR-MESSAGE 
               LINE 11 COL 5.
       
       PROCEDURE DIVISION.
       MAIN-PROGRAM.
           PERFORM 1000-INITIALIZE-PROGRAM
           PERFORM 2000-PROCESS-ACCOUNTS
           PERFORM 3000-GENERATE-REPORTS
           PERFORM 4000-CLOSE-FILES
           STOP RUN.
       
       1000-INITIALIZE-PROGRAM.
           DISPLAY "INITIALIZING ACCOUNT MANAGEMENT SYSTEM"
           MOVE ZERO TO WS-TOTAL-BALANCE
           MOVE ZERO TO WS-RECORD-COUNT
           OPEN INPUT ACCOUNT-FILE
           OPEN OUTPUT REPORT-FILE
           IF WS-FILE-STATUS NOT = "00"
               MOVE 001 TO WS-ERROR-CODE
               MOVE "FILE OPEN ERROR" TO WS-ERROR-MESSAGE
               PERFORM 9000-ERROR-HANDLER
           END-IF.
       
       2000-PROCESS-ACCOUNTS.
           PERFORM UNTIL WS-EOF-FLAG = 'Y'
               READ ACCOUNT-FILE
                   AT END
                       MOVE 'Y' TO WS-EOF-FLAG
                   NOT AT END
                       PERFORM 2100-PROCESS-SINGLE-ACCOUNT
               END-READ
           END-PERFORM.
       
       2100-PROCESS-SINGLE-ACCOUNT.
           MOVE ACCOUNT-NUMBER TO WS-ACCOUNT-NUM
           MOVE CUSTOMER-NAME TO WS-CUSTOMER-NAME
           MOVE ACCOUNT-BALANCE TO WS-BALANCE
           MOVE ACCOUNT-TYPE TO WS-ACCOUNT-TYPE
           
           ADD 1 TO WS-RECORD-COUNT
           ADD WS-BALANCE TO WS-TOTAL-BALANCE
           
           PERFORM 2200-CALCULATE-INTEREST
           PERFORM 2300-ASSESS-RISK
           PERFORM 2400-UPDATE-BALANCE
           
           IF WS-BALANCE > 10000
               PERFORM 2500-HIGH-BALANCE-PROCESSING
           END-IF.
       
       2200-CALCULATE-INTEREST.
           COMPUTE WS-INTEREST-AMOUNT = 
               WS-BALANCE * WS-INTEREST-RATE / 100
           COMPUTE WS-NEW-BALANCE = 
               WS-BALANCE + WS-INTEREST-AMOUNT.
       
       2300-ASSESS-RISK.
           IF WS-BALANCE > 50000
               MOVE 100 TO WS-RISK-SCORE
           ELSE
               IF WS-BALANCE > 10000
                   MOVE 50 TO WS-RISK-SCORE
               ELSE
                   MOVE 10 TO WS-RISK-SCORE
               END-IF
           END-IF.
       
       2400-UPDATE-BALANCE.
           MOVE WS-NEW-BALANCE TO WS-BALANCE
           MOVE WS-BALANCE TO ACCOUNT-BALANCE.
       
       2500-HIGH-BALANCE-PROCESSING.
           DISPLAY "HIGH BALANCE ACCOUNT: " WS-ACCOUNT-NUM
           CALL "HIGH-VALUE-PROCESSOR" USING WS-ACCOUNT-NUM
               WS-BALANCE
           ON EXCEPTION
               MOVE 002 TO WS-ERROR-CODE
               MOVE "CALL ERROR" TO WS-ERROR-MESSAGE
               PERFORM 9000-ERROR-HANDLER
           END-CALL.
       
       3000-GENERATE-REPORTS.
           COMPUTE WS-AVERAGE-BALANCE = 
               WS-TOTAL-BALANCE / WS-RECORD-COUNT
           
           MOVE "ACCOUNT SUMMARY REPORT" TO REPORT-LINE
           WRITE REPORT-RECORD
           
           MOVE "TOTAL ACCOUNTS: " TO REPORT-LINE
           MOVE WS-RECORD-COUNT TO REPORT-LINE(16:5)
           WRITE REPORT-RECORD
           
           MOVE "TOTAL BALANCE: " TO REPORT-LINE
           MOVE WS-TOTAL-BALANCE TO REPORT-LINE(16:12)
           WRITE REPORT-RECORD
           
           MOVE "AVERAGE BALANCE: " TO REPORT-LINE
           MOVE WS-AVERAGE-BALANCE TO REPORT-LINE(17:10)
           WRITE REPORT-RECORD.
       
       4000-CLOSE-FILES.
           CLOSE ACCOUNT-FILE
           CLOSE REPORT-FILE
           DISPLAY "PROCESSING COMPLETE".
       
       9000-ERROR-HANDLER.
           DISPLAY "ERROR CODE: " WS-ERROR-CODE
           DISPLAY "ERROR MESSAGE: " WS-ERROR-MESSAGE
           MOVE WS-ERROR-MESSAGE TO WS-DISPLAY-MESSAGE
           DISPLAY ERROR-SCREEN
           STOP RUN.
       
       COPY BANKING-COPYBOOK REPLACING ACCOUNT BY CUSTOMER
           BALANCE BY AMOUNT.
       
       COPY ERROR-HANDLING REPLACING ERROR-CODE BY ERR-CODE.
       
       END PROGRAM COMPREHENSIVE-RELATIONSHIP-TEST.
