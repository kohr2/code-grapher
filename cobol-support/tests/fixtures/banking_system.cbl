       IDENTIFICATION DIVISION.
       PROGRAM-ID. BANKING-SYSTEM.
       AUTHOR. CODE-GRAPHER-TEST.
       DATE-WRITTEN. 2025-01-27.
       DATE-COMPILED. 2025-01-27.
       SECURITY. BANKING-APPLICATION.

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-370.
       OBJECT-COMPUTER. IBM-370.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CUSTOMER-FILE ASSIGN TO 'CUSTOMER'
               ORGANIZATION IS INDEXED
               ACCESS MODE IS RANDOM
               RECORD KEY IS CUST-ACCOUNT-NUMBER
               ALTERNATE RECORD KEY IS CUST-SSN WITH DUPLICATES.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT'
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL.
           SELECT REPORT-FILE ASSIGN TO 'REPORT'
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  CUSTOMER-FILE
           LABEL RECORDS ARE STANDARD
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  CUSTOMER-RECORD.
           05  CUST-ACCOUNT-NUMBER     PIC X(10).
           05  CUST-SSN               PIC X(9).
           05  CUST-LAST-NAME         PIC X(25).
           05  CUST-FIRST-NAME        PIC X(20).
           05  CUST-MIDDLE-INITIAL    PIC X(1).
           05  CUST-ADDRESS.
               10  CUST-STREET        PIC X(30).
               10  CUST-CITY          PIC X(20).
               10  CUST-STATE         PIC X(2).
               10  CUST-ZIP           PIC X(10).
           05  CUST-PHONE             PIC X(12).
           05  CUST-EMAIL             PIC X(40).
           05  CUST-DATE-OF-BIRTH     PIC X(8).
           05  CUST-ACCOUNT-TYPE      PIC X(1).
               88  CHECKING-ACCOUNT   VALUE 'C'.
               88  SAVINGS-ACCOUNT    VALUE 'S'.
               88  BUSINESS-ACCOUNT   VALUE 'B'.
           05  CUST-ACCOUNT-BALANCE   PIC S9(7)V99 COMP-3.
           05  CUST-CREDIT-LIMIT      PIC S9(7)V99 COMP-3.
           05  CUST-OVERDRAFT-LIMIT   PIC S9(5)V99 COMP-3.
           05  CUST-INTEREST-RATE     PIC 9(3)V9999 COMP-3.
           05  CUST-STATUS            PIC X(1).
               88  ACTIVE-ACCOUNT     VALUE 'A'.
               88  INACTIVE-ACCOUNT   VALUE 'I'.
               88  SUSPENDED-ACCOUNT  VALUE 'S'.
           05  CUST-OPEN-DATE         PIC X(8).
           05  CUST-LAST-ACTIVITY     PIC X(8).

       FD  TRANSACTION-FILE
           LABEL RECORDS ARE STANDARD
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  TRANSACTION-RECORD.
           05  TRANS-ID               PIC X(10).
           05  TRANS-ACCOUNT-NUMBER   PIC X(10).
           05  TRANS-DATE             PIC X(8).
           05  TRANS-TIME             PIC X(6).
           05  TRANS-TYPE             PIC X(1).
               88  DEPOSIT            VALUE 'D'.
               88  WITHDRAWAL         VALUE 'W'.
               88  TRANSFER           VALUE 'T'.
               88  PAYMENT            VALUE 'P'.
               88  FEE                VALUE 'F'.
           05  TRANS-AMOUNT           PIC S9(7)V99 COMP-3.
           05  TRANS-DESCRIPTION      PIC X(30).
           05  TRANS-REFERENCE        PIC X(15).
           05  TRANS-BALANCE-AFTER    PIC S9(7)V99 COMP-3.

       FD  REPORT-FILE
           LABEL RECORDS ARE STANDARD
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD             PIC X(132).

       WORKING-STORAGE SECTION.
       01  WS-CONTROL-FIELDS.
           05  WS-EOF-FLAG           PIC X(1) VALUE 'N'.
               88  END-OF-FILE        VALUE 'Y'.
           05  WS-ERROR-FLAG         PIC X(1) VALUE 'N'.
               88  ERROR-OCCURRED     VALUE 'Y'.
           05  WS-RECORD-COUNT       PIC 9(6) VALUE ZERO.
           05  WS-TOTAL-AMOUNT       PIC S9(9)V99 COMP-3 VALUE ZERO.
           05  WS-CURRENT-DATE       PIC X(8).
           05  WS-CURRENT-TIME       PIC X(6).

       01  WS-CUSTOMER-FIELDS.
           05  WS-CUSTOMER-FOUND     PIC X(1) VALUE 'N'.
               88  CUSTOMER-EXISTS    VALUE 'Y'.
           05  WS-NEW-BALANCE        PIC S9(7)V99 COMP-3.
           05  WS-TRANSACTION-AMOUNT PIC S9(7)V99 COMP-3.
           05  WS-MINIMUM-BALANCE    PIC S9(5)V99 COMP-3 VALUE 100.00.

       01  WS-REPORT-FIELDS.
           05  WS-PAGE-NUMBER        PIC 9(3) VALUE ZERO.
           05  WS-LINE-COUNT         PIC 9(2) VALUE ZERO.
           05  WS-LINES-PER-PAGE     PIC 9(2) VALUE 50.
           05  WS-REPORT-DATE        PIC X(8).
           05  WS-REPORT-TIME        PIC X(6).

       01  WS-HEADER-LINE.
           05  FILLER                PIC X(20) VALUE 'BANKING SYSTEM REPORT'.
           05  FILLER                PIC X(20) VALUE SPACES.
           05  WS-HEADER-DATE        PIC X(8).
           05  FILLER                PIC X(5) VALUE SPACES.
           05  WS-HEADER-TIME        PIC X(6).
           05  FILLER                PIC X(20) VALUE SPACES.
           05  FILLER                PIC X(10) VALUE 'PAGE: '.
           05  WS-HEADER-PAGE        PIC ZZZ.

       01  WS-DETAIL-LINE.
           05  WS-DET-ACCOUNT        PIC X(10).
           05  FILLER                PIC X(2) VALUE SPACES.
           05  WS-DET-NAME           PIC X(30).
           05  FILLER                PIC X(2) VALUE SPACES.
           05  WS-DET-BALANCE        PIC $$$,$$$,$$9.99.
           05  FILLER                PIC X(2) VALUE SPACES.
           05  WS-DET-STATUS         PIC X(10).
           05  FILLER                PIC X(2) VALUE SPACES.
           05  WS-DET-TYPE           PIC X(10).

       01  WS-SUMMARY-LINE.
           05  FILLER                PIC X(20) VALUE 'TOTAL ACCOUNTS: '.
           05  WS-SUM-COUNT          PIC ZZZ,ZZ9.
           05  FILLER                PIC X(20) VALUE 'TOTAL BALANCE: '.
           05  WS-SUM-BALANCE        PIC $$$,$$$,$$$,$$9.99.

       01  WS-ERROR-MESSAGES.
           05  WS-ERROR-MSG-1        PIC X(50) VALUE 
               'INVALID ACCOUNT NUMBER - CUSTOMER NOT FOUND'.
           05  WS-ERROR-MSG-2        PIC X(50) VALUE 
               'INSUFFICIENT FUNDS - TRANSACTION DENIED'.
           05  WS-ERROR-MSG-3        PIC X(50) VALUE 
               'INVALID TRANSACTION TYPE - OPERATION FAILED'.
           05  WS-ERROR-MSG-4        PIC X(50) VALUE 
               'ACCOUNT SUSPENDED - NO TRANSACTIONS ALLOWED'.

       01  WS-MENU-OPTIONS.
           05  WS-MENU-CHOICE        PIC X(1).
               88  CREATE-ACCOUNT     VALUE '1'.
               88  DEPOSIT-FUNDS      VALUE '2'.
               88  WITHDRAW-FUNDS     VALUE '3'.
               88  TRANSFER-FUNDS     VALUE '4'.
               88  ACCOUNT-INQUIRY    VALUE '5'.
               88  GENERATE-REPORT    VALUE '6'.
               88  EXIT-PROGRAM       VALUE '9'.

       PROCEDURE DIVISION.
       0000-MAIN-PROGRAM.
           PERFORM 1000-INITIALIZE-PROGRAM
           PERFORM 2000-DISPLAY-MENU
           PERFORM 3000-PROCESS-MENU-CHOICE
           PERFORM 9000-CLOSE-FILES
           PERFORM 9999-END-PROGRAM.

       1000-INITIALIZE-PROGRAM.
           DISPLAY 'BANKING SYSTEM INITIALIZATION STARTED'
           ACCEPT WS-CURRENT-DATE FROM DATE
           ACCEPT WS-CURRENT-TIME FROM TIME
           OPEN INPUT CUSTOMER-FILE
           OPEN INPUT TRANSACTION-FILE
           OPEN OUTPUT REPORT-FILE
           DISPLAY 'BANKING SYSTEM INITIALIZATION COMPLETED'.

       2000-DISPLAY-MENU.
           DISPLAY ' '
           DISPLAY '========================================'
           DISPLAY '        BANKING SYSTEM MAIN MENU'
           DISPLAY '========================================'
           DISPLAY '1. CREATE NEW ACCOUNT'
           DISPLAY '2. DEPOSIT FUNDS'
           DISPLAY '3. WITHDRAW FUNDS'
           DISPLAY '4. TRANSFER FUNDS'
           DISPLAY '5. ACCOUNT INQUIRY'
           DISPLAY '6. GENERATE REPORT'
           DISPLAY '9. EXIT PROGRAM'
           DISPLAY '========================================'
           DISPLAY 'ENTER YOUR CHOICE (1-6, 9): '
           ACCEPT WS-MENU-CHOICE.

       3000-PROCESS-MENU-CHOICE.
           EVALUATE TRUE
               WHEN CREATE-ACCOUNT
                   PERFORM 4000-CREATE-ACCOUNT
               WHEN DEPOSIT-FUNDS
                   PERFORM 5000-DEPOSIT-FUNDS
               WHEN WITHDRAW-FUNDS
                   PERFORM 6000-WITHDRAW-FUNDS
               WHEN TRANSFER-FUNDS
                   PERFORM 7000-TRANSFER-FUNDS
               WHEN ACCOUNT-INQUIRY
                   PERFORM 8000-ACCOUNT-INQUIRY
               WHEN GENERATE-REPORT
                   PERFORM 8500-GENERATE-REPORT
               WHEN EXIT-PROGRAM
                   DISPLAY 'THANK YOU FOR USING BANKING SYSTEM'
               WHEN OTHER
                   DISPLAY 'INVALID CHOICE - PLEASE TRY AGAIN'
           END-EVALUATE.

       4000-CREATE-ACCOUNT.
           DISPLAY 'CREATE NEW ACCOUNT PROCESS STARTED'
           PERFORM 4100-GET-CUSTOMER-DATA
           PERFORM 4200-VALIDATE-CUSTOMER-DATA
           IF NOT ERROR-OCCURRED
               PERFORM 4300-WRITE-CUSTOMER-RECORD
               PERFORM 4400-CREATE-INITIAL-TRANSACTION
           END-IF
           DISPLAY 'CREATE NEW ACCOUNT PROCESS COMPLETED'.

       4100-GET-CUSTOMER-DATA.
           DISPLAY 'ENTER CUSTOMER INFORMATION:'
           DISPLAY 'ACCOUNT NUMBER: '
           ACCEPT CUST-ACCOUNT-NUMBER
           DISPLAY 'SOCIAL SECURITY NUMBER: '
           ACCEPT CUST-SSN
           DISPLAY 'LAST NAME: '
           ACCEPT CUST-LAST-NAME
           DISPLAY 'FIRST NAME: '
           ACCEPT CUST-FIRST-NAME
           DISPLAY 'MIDDLE INITIAL: '
           ACCEPT CUST-MIDDLE-INITIAL
           DISPLAY 'STREET ADDRESS: '
           ACCEPT CUST-STREET
           DISPLAY 'CITY: '
           ACCEPT CUST-CITY
           DISPLAY 'STATE: '
           ACCEPT CUST-STATE
           DISPLAY 'ZIP CODE: '
           ACCEPT CUST-ZIP
           DISPLAY 'PHONE NUMBER: '
           ACCEPT CUST-PHONE
           DISPLAY 'EMAIL ADDRESS: '
           ACCEPT CUST-EMAIL
           DISPLAY 'DATE OF BIRTH (YYYYMMDD): '
           ACCEPT CUST-DATE-OF-BIRTH
           DISPLAY 'ACCOUNT TYPE (C=CHECKING, S=SAVINGS, B=BUSINESS): '
           ACCEPT CUST-ACCOUNT-TYPE
           DISPLAY 'INITIAL DEPOSIT AMOUNT: '
           ACCEPT CUST-ACCOUNT-BALANCE
           DISPLAY 'CREDIT LIMIT: '
           ACCEPT CUST-CREDIT-LIMIT
           DISPLAY 'OVERDRAFT LIMIT: '
           ACCEPT CUST-OVERDRAFT-LIMIT
           DISPLAY 'INTEREST RATE: '
           ACCEPT CUST-INTEREST-RATE
           MOVE 'A' TO CUST-STATUS
           MOVE WS-CURRENT-DATE TO CUST-OPEN-DATE
           MOVE WS-CURRENT-DATE TO CUST-LAST-ACTIVITY.

       4200-VALIDATE-CUSTOMER-DATA.
           IF CUST-ACCOUNT-NUMBER = SPACES
               DISPLAY WS-ERROR-MSG-1
               SET ERROR-OCCURRED TO TRUE
           END-IF
           IF CUST-SSN = SPACES
               DISPLAY 'INVALID SOCIAL SECURITY NUMBER'
               SET ERROR-OCCURRED TO TRUE
           END-IF
           IF CUST-LAST-NAME = SPACES
               DISPLAY 'INVALID LAST NAME'
               SET ERROR-OCCURRED TO TRUE
           END-IF
           IF CUST-FIRST-NAME = SPACES
               DISPLAY 'INVALID FIRST NAME'
               SET ERROR-OCCURRED TO TRUE
           END-IF
           IF NOT (CHECKING-ACCOUNT OR SAVINGS-ACCOUNT OR BUSINESS-ACCOUNT)
               DISPLAY 'INVALID ACCOUNT TYPE'
               SET ERROR-OCCURRED TO TRUE
           END-IF
           IF CUST-ACCOUNT-BALANCE < ZERO
               DISPLAY 'INITIAL DEPOSIT CANNOT BE NEGATIVE'
               SET ERROR-OCCURRED TO TRUE
           END-IF.

       4300-WRITE-CUSTOMER-RECORD.
           WRITE CUSTOMER-RECORD
           IF NOT ERROR-OCCURRED
               DISPLAY 'CUSTOMER RECORD CREATED SUCCESSFULLY'
               ADD 1 TO WS-RECORD-COUNT
           ELSE
               DISPLAY 'ERROR CREATING CUSTOMER RECORD'
           END-IF.

       4400-CREATE-INITIAL-TRANSACTION.
           MOVE 'INIT' TO TRANS-ID
           MOVE CUST-ACCOUNT-NUMBER TO TRANS-ACCOUNT-NUMBER
           MOVE WS-CURRENT-DATE TO TRANS-DATE
           MOVE WS-CURRENT-TIME TO TRANS-TIME
           MOVE 'D' TO TRANS-TYPE
           MOVE CUST-ACCOUNT-BALANCE TO TRANS-AMOUNT
           MOVE 'INITIAL DEPOSIT' TO TRANS-DESCRIPTION
           MOVE 'OPENING' TO TRANS-REFERENCE
           MOVE CUST-ACCOUNT-BALANCE TO TRANS-BALANCE-AFTER
           WRITE TRANSACTION-RECORD.

       5000-DEPOSIT-FUNDS.
           DISPLAY 'DEPOSIT FUNDS PROCESS STARTED'
           PERFORM 5100-GET-ACCOUNT-INFO
           IF CUSTOMER-EXISTS
               PERFORM 5200-GET-DEPOSIT-AMOUNT
               PERFORM 5300-PROCESS-DEPOSIT
           ELSE
               DISPLAY WS-ERROR-MSG-1
           END-IF
           DISPLAY 'DEPOSIT FUNDS PROCESS COMPLETED'.

       5100-GET-ACCOUNT-INFO.
           DISPLAY 'ENTER ACCOUNT NUMBER: '
           ACCEPT CUST-ACCOUNT-NUMBER
           READ CUSTOMER-FILE
           IF NOT ERROR-OCCURRED
               SET CUSTOMER-EXISTS TO TRUE
           ELSE
               SET CUSTOMER-EXISTS TO FALSE
           END-IF.

       5200-GET-DEPOSIT-AMOUNT.
           DISPLAY 'ENTER DEPOSIT AMOUNT: '
           ACCEPT WS-TRANSACTION-AMOUNT
           IF WS-TRANSACTION-AMOUNT <= ZERO
               DISPLAY 'DEPOSIT AMOUNT MUST BE POSITIVE'
               SET ERROR-OCCURRED TO TRUE
           END-IF.

       5300-PROCESS-DEPOSIT.
           IF NOT ERROR-OCCURRED
               COMPUTE WS-NEW-BALANCE = CUST-ACCOUNT-BALANCE + 
                                       WS-TRANSACTION-AMOUNT
               MOVE WS-NEW-BALANCE TO CUST-ACCOUNT-BALANCE
               MOVE WS-CURRENT-DATE TO CUST-LAST-ACTIVITY
               REWRITE CUSTOMER-RECORD
               PERFORM 5400-CREATE-TRANSACTION-RECORD
               DISPLAY 'DEPOSIT PROCESSED SUCCESSFULLY'
               DISPLAY 'NEW BALANCE: ' WS-NEW-BALANCE
           END-IF.

       5400-CREATE-TRANSACTION-RECORD.
           MOVE 'DEP' TO TRANS-ID
           MOVE CUST-ACCOUNT-NUMBER TO TRANS-ACCOUNT-NUMBER
           MOVE WS-CURRENT-DATE TO TRANS-DATE
           MOVE WS-CURRENT-TIME TO TRANS-TIME
           MOVE 'D' TO TRANS-TYPE
           MOVE WS-TRANSACTION-AMOUNT TO TRANS-AMOUNT
           MOVE 'CASH DEPOSIT' TO TRANS-DESCRIPTION
           MOVE 'TELLER' TO TRANS-REFERENCE
           MOVE WS-NEW-BALANCE TO TRANS-BALANCE-AFTER
           WRITE TRANSACTION-RECORD.

       6000-WITHDRAW-FUNDS.
           DISPLAY 'WITHDRAW FUNDS PROCESS STARTED'
           PERFORM 5100-GET-ACCOUNT-INFO
           IF CUSTOMER-EXISTS
               PERFORM 6100-GET-WITHDRAWAL-AMOUNT
               PERFORM 6200-VALIDATE-WITHDRAWAL
               IF NOT ERROR-OCCURRED
                   PERFORM 6300-PROCESS-WITHDRAWAL
               END-IF
           ELSE
               DISPLAY WS-ERROR-MSG-1
           END-IF
           DISPLAY 'WITHDRAW FUNDS PROCESS COMPLETED'.

       6100-GET-WITHDRAWAL-AMOUNT.
           DISPLAY 'ENTER WITHDRAWAL AMOUNT: '
           ACCEPT WS-TRANSACTION-AMOUNT
           IF WS-TRANSACTION-AMOUNT <= ZERO
               DISPLAY 'WITHDRAWAL AMOUNT MUST BE POSITIVE'
               SET ERROR-OCCURRED TO TRUE
           END-IF.

       6200-VALIDATE-WITHDRAWAL.
           IF SUSPENDED-ACCOUNT
               DISPLAY WS-ERROR-MSG-4
               SET ERROR-OCCURRED TO TRUE
           END-IF
           COMPUTE WS-NEW-BALANCE = CUST-ACCOUNT-BALANCE - 
                                   WS-TRANSACTION-AMOUNT
           IF WS-NEW-BALANCE < WS-MINIMUM-BALANCE
               IF WS-NEW-BALANCE < (CUST-ACCOUNT-BALANCE - CUST-OVERDRAFT-LIMIT)
                   DISPLAY WS-ERROR-MSG-2
                   SET ERROR-OCCURRED TO TRUE
               END-IF
           END-IF.

       6300-PROCESS-WITHDRAWAL.
           MOVE WS-NEW-BALANCE TO CUST-ACCOUNT-BALANCE
           MOVE WS-CURRENT-DATE TO CUST-LAST-ACTIVITY
           REWRITE CUSTOMER-RECORD
           PERFORM 6400-CREATE-WITHDRAWAL-TRANSACTION
           DISPLAY 'WITHDRAWAL PROCESSED SUCCESSFULLY'
           DISPLAY 'NEW BALANCE: ' WS-NEW-BALANCE.

       6400-CREATE-WITHDRAWAL-TRANSACTION.
           MOVE 'WTH' TO TRANS-ID
           MOVE CUST-ACCOUNT-NUMBER TO TRANS-ACCOUNT-NUMBER
           MOVE WS-CURRENT-DATE TO TRANS-DATE
           MOVE WS-CURRENT-TIME TO TRANS-TIME
           MOVE 'W' TO TRANS-TYPE
           MOVE WS-TRANSACTION-AMOUNT TO TRANS-AMOUNT
           MOVE 'CASH WITHDRAWAL' TO TRANS-DESCRIPTION
           MOVE 'ATM' TO TRANS-REFERENCE
           MOVE WS-NEW-BALANCE TO TRANS-BALANCE-AFTER
           WRITE TRANSACTION-RECORD.

       7000-TRANSFER-FUNDS.
           DISPLAY 'TRANSFER FUNDS PROCESS STARTED'
           PERFORM 7100-GET-TRANSFER-ACCOUNTS
           IF CUSTOMER-EXISTS
               PERFORM 7200-GET-TRANSFER-AMOUNT
               PERFORM 7300-VALIDATE-TRANSFER
               IF NOT ERROR-OCCURRED
                   PERFORM 7400-PROCESS-TRANSFER
               END-IF
           ELSE
               DISPLAY WS-ERROR-MSG-1
           END-IF
           DISPLAY 'TRANSFER FUNDS PROCESS COMPLETED'.

       7100-GET-TRANSFER-ACCOUNTS.
           DISPLAY 'ENTER FROM ACCOUNT NUMBER: '
           ACCEPT CUST-ACCOUNT-NUMBER
           READ CUSTOMER-FILE
           IF NOT ERROR-OCCURRED
               SET CUSTOMER-EXISTS TO TRUE
           ELSE
               SET CUSTOMER-EXISTS TO FALSE
           END-IF.

       7200-GET-TRANSFER-AMOUNT.
           DISPLAY 'ENTER TRANSFER AMOUNT: '
           ACCEPT WS-TRANSACTION-AMOUNT
           IF WS-TRANSACTION-AMOUNT <= ZERO
               DISPLAY 'TRANSFER AMOUNT MUST BE POSITIVE'
               SET ERROR-OCCURRED TO TRUE
           END-IF.

       7300-VALIDATE-TRANSFER.
           IF SUSPENDED-ACCOUNT
               DISPLAY WS-ERROR-MSG-4
               SET ERROR-OCCURRED TO TRUE
           END-IF
           COMPUTE WS-NEW-BALANCE = CUST-ACCOUNT-BALANCE - 
                                   WS-TRANSACTION-AMOUNT
           IF WS-NEW-BALANCE < WS-MINIMUM-BALANCE
               IF WS-NEW-BALANCE < (CUST-ACCOUNT-BALANCE - CUST-OVERDRAFT-LIMIT)
                   DISPLAY WS-ERROR-MSG-2
                   SET ERROR-OCCURRED TO TRUE
               END-IF
           END-IF.

       7400-PROCESS-TRANSFER.
           MOVE WS-NEW-BALANCE TO CUST-ACCOUNT-BALANCE
           MOVE WS-CURRENT-DATE TO CUST-LAST-ACTIVITY
           REWRITE CUSTOMER-RECORD
           PERFORM 7500-CREATE-TRANSFER-TRANSACTIONS
           DISPLAY 'TRANSFER PROCESSED SUCCESSFULLY'
           DISPLAY 'NEW BALANCE: ' WS-NEW-BALANCE.

       7500-CREATE-TRANSFER-TRANSACTIONS.
           MOVE 'TRF' TO TRANS-ID
           MOVE CUST-ACCOUNT-NUMBER TO TRANS-ACCOUNT-NUMBER
           MOVE WS-CURRENT-DATE TO TRANS-DATE
           MOVE WS-CURRENT-TIME TO TRANS-TIME
           MOVE 'T' TO TRANS-TYPE
           MOVE WS-TRANSACTION-AMOUNT TO TRANS-AMOUNT
           MOVE 'TRANSFER OUT' TO TRANS-DESCRIPTION
           MOVE 'ONLINE' TO TRANS-REFERENCE
           MOVE WS-NEW-BALANCE TO TRANS-BALANCE-AFTER
           WRITE TRANSACTION-RECORD.

       8000-ACCOUNT-INQUIRY.
           DISPLAY 'ACCOUNT INQUIRY PROCESS STARTED'
           PERFORM 5100-GET-ACCOUNT-INFO
           IF CUSTOMER-EXISTS
               PERFORM 8100-DISPLAY-ACCOUNT-INFO
           ELSE
               DISPLAY WS-ERROR-MSG-1
           END-IF
           DISPLAY 'ACCOUNT INQUIRY PROCESS COMPLETED'.

       8100-DISPLAY-ACCOUNT-INFO.
           DISPLAY ' '
           DISPLAY '========================================'
           DISPLAY '        ACCOUNT INFORMATION'
           DISPLAY '========================================'
           DISPLAY 'ACCOUNT NUMBER: ' CUST-ACCOUNT-NUMBER
           DISPLAY 'CUSTOMER NAME: ' CUST-FIRST-NAME ' ' 
                   CUST-MIDDLE-INITIAL ' ' CUST-LAST-NAME
           DISPLAY 'ADDRESS: ' CUST-STREET
           DISPLAY '         ' CUST-CITY ', ' CUST-STATE ' ' CUST-ZIP
           DISPLAY 'PHONE: ' CUST-PHONE
           DISPLAY 'EMAIL: ' CUST-EMAIL
           DISPLAY 'ACCOUNT TYPE: ' CUST-ACCOUNT-TYPE
           DISPLAY 'CURRENT BALANCE: $' CUST-ACCOUNT-BALANCE
           DISPLAY 'CREDIT LIMIT: $' CUST-CREDIT-LIMIT
           DISPLAY 'OVERDRAFT LIMIT: $' CUST-OVERDRAFT-LIMIT
           DISPLAY 'INTEREST RATE: ' CUST-INTEREST-RATE '%'
           DISPLAY 'ACCOUNT STATUS: ' CUST-STATUS
           DISPLAY 'OPEN DATE: ' CUST-OPEN-DATE
           DISPLAY 'LAST ACTIVITY: ' CUST-LAST-ACTIVITY
           DISPLAY '========================================'.

       8500-GENERATE-REPORT.
           DISPLAY 'GENERATE REPORT PROCESS STARTED'
           PERFORM 8510-INITIALIZE-REPORT
           PERFORM 8520-PROCESS-CUSTOMER-FILE
           PERFORM 8530-WRITE-SUMMARY
           DISPLAY 'GENERATE REPORT PROCESS COMPLETED'.

       8510-INITIALIZE-REPORT.
           MOVE WS-CURRENT-DATE TO WS-REPORT-DATE
           MOVE WS-CURRENT-TIME TO WS-REPORT-TIME
           MOVE WS-REPORT-DATE TO WS-HEADER-DATE
           MOVE WS-REPORT-TIME TO WS-HEADER-TIME
           MOVE 1 TO WS-PAGE-NUMBER
           MOVE WS-PAGE-NUMBER TO WS-HEADER-PAGE
           WRITE REPORT-RECORD FROM WS-HEADER-LINE
           MOVE SPACES TO REPORT-RECORD
           WRITE REPORT-RECORD.

       8520-PROCESS-CUSTOMER-FILE.
           MOVE ZERO TO WS-RECORD-COUNT
           MOVE ZERO TO WS-TOTAL-AMOUNT
           START CUSTOMER-FILE KEY IS GREATER THAN CUST-ACCOUNT-NUMBER
           READ CUSTOMER-FILE NEXT RECORD
           PERFORM UNTIL END-OF-FILE
               ADD 1 TO WS-RECORD-COUNT
               ADD CUST-ACCOUNT-BALANCE TO WS-TOTAL-AMOUNT
               PERFORM 8525-WRITE-DETAIL-LINE
               READ CUSTOMER-FILE NEXT RECORD
           END-PERFORM.

       8525-WRITE-DETAIL-LINE.
           MOVE CUST-ACCOUNT-NUMBER TO WS-DET-ACCOUNT
           MOVE CUST-LAST-NAME TO WS-DET-NAME
           MOVE CUST-ACCOUNT-BALANCE TO WS-DET-BALANCE
           EVALUATE CUST-STATUS
               WHEN 'A' MOVE 'ACTIVE' TO WS-DET-STATUS
               WHEN 'I' MOVE 'INACTIVE' TO WS-DET-STATUS
               WHEN 'S' MOVE 'SUSPENDED' TO WS-DET-STATUS
               WHEN OTHER MOVE 'UNKNOWN' TO WS-DET-STATUS
           END-EVALUATE
           EVALUATE CUST-ACCOUNT-TYPE
               WHEN 'C' MOVE 'CHECKING' TO WS-DET-TYPE
               WHEN 'S' MOVE 'SAVINGS' TO WS-DET-TYPE
               WHEN 'B' MOVE 'BUSINESS' TO WS-DET-TYPE
               WHEN OTHER MOVE 'UNKNOWN' TO WS-DET-TYPE
           END-EVALUATE
           WRITE REPORT-RECORD FROM WS-DETAIL-LINE
           ADD 1 TO WS-LINE-COUNT
           IF WS-LINE-COUNT >= WS-LINES-PER-PAGE
               PERFORM 8527-NEW-PAGE
           END-IF.

       8527-NEW-PAGE.
           MOVE SPACES TO REPORT-RECORD
           WRITE REPORT-RECORD
           ADD 1 TO WS-PAGE-NUMBER
           MOVE WS-PAGE-NUMBER TO WS-HEADER-PAGE
           WRITE REPORT-RECORD FROM WS-HEADER-LINE
           MOVE SPACES TO REPORT-RECORD
           WRITE REPORT-RECORD
           MOVE ZERO TO WS-LINE-COUNT.

       8530-WRITE-SUMMARY.
           MOVE SPACES TO REPORT-RECORD
           WRITE REPORT-RECORD
           MOVE WS-RECORD-COUNT TO WS-SUM-COUNT
           MOVE WS-TOTAL-AMOUNT TO WS-SUM-BALANCE
           WRITE REPORT-RECORD FROM WS-SUMMARY-LINE.

       9000-CLOSE-FILES.
           CLOSE CUSTOMER-FILE
           CLOSE TRANSACTION-FILE
           CLOSE REPORT-FILE
           DISPLAY 'ALL FILES CLOSED SUCCESSFULLY'.

       9999-END-PROGRAM.
           DISPLAY 'BANKING SYSTEM PROGRAM ENDED'
           STOP RUN.
