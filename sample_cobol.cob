000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. SAMPLE-PROGRAM.
000300 AUTHOR. DEVELOPER.
000400 DATE-WRITTEN. 2024-01-01.
000500
000600 ENVIRONMENT DIVISION.
000700 CONFIGURATION SECTION.
000800 SOURCE-COMPUTER. IBM-370.
000900 OBJECT-COMPUTER. IBM-370.
001000 INPUT-OUTPUT SECTION.
001100 FILE-CONTROL.
001200     SELECT INPUT-FILE ASSIGN TO INPUT.
001300     SELECT OUTPUT-FILE ASSIGN TO OUTPUT.
001400
001500 DATA DIVISION.
001600 FILE SECTION.
001700 FD INPUT-FILE.
001800 01 INPUT-RECORD.
001900    05 CUSTOMER-ID PIC X(10).
002000    05 CUSTOMER-NAME PIC X(30).
002100    05 BALANCE PIC 9(7)V99.
002200
002300 FD OUTPUT-FILE.
002400 01 OUTPUT-RECORD.
002500    05 CUSTOMER-ID PIC X(10).
002600    05 CUSTOMER-NAME PIC X(30).
002700    05 BALANCE PIC 9(7)V99.
002800    05 STATUS-CODE PIC X(1).
002900
003000 WORKING-STORAGE SECTION.
003100 01 WS-COUNTERS.
003200    05 WS-RECORD-COUNT PIC 9(5) VALUE ZERO.
003300    05 WS-TOTAL-BALANCE PIC 9(9)V99 VALUE ZERO.
003400    05 WS-AVERAGE-BALANCE PIC 9(7)V99 VALUE ZERO.
003500
003600 01 WS-FLAGS.
003700    05 WS-EOF-FLAG PIC X(1) VALUE 'N'.
003800    05 WS-ERROR-FLAG PIC X(1) VALUE 'N'.
003900
004000 01 WS-CALCULATIONS.
004100    05 WS-TEMP-VALUE PIC 9(7)V99.
004200    05 WS-DIVISOR PIC 9(5) VALUE ZERO.
004300
004400 PROCEDURE DIVISION.
004500 1000-MAIN-PROCESSING SECTION.
004600 1100-INITIALIZE-PROGRAM.
004700     DISPLAY 'PROGRAM STARTING'.
004800     MOVE ZERO TO WS-RECORD-COUNT.
004900     MOVE ZERO TO WS-TOTAL-BALANCE.
005000     MOVE 'N' TO WS-EOF-FLAG.
005100     MOVE 'N' TO WS-ERROR-FLAG.
005200     PERFORM 2000-OPEN-FILES.
005300     IF WS-ERROR-FLAG = 'Y'
005400         PERFORM 9000-ERROR-HANDLER
005500     ELSE
005600         PERFORM 3000-PROCESS-RECORDS
005700     END-IF.
005800     PERFORM 8000-CLOSE-FILES.
005900     PERFORM 7000-DISPLAY-RESULTS.
006000     STOP RUN.
006100
006200 1200-VALIDATE-INPUT.
006300     IF CUSTOMER-ID = SPACES
006400         MOVE 'Y' TO WS-ERROR-FLAG
006500         DISPLAY 'ERROR: CUSTOMER-ID IS BLANK'
006600     END-IF.
006700     IF CUSTOMER-NAME = SPACES
006800         MOVE 'Y' TO WS-ERROR-FLAG
006900         DISPLAY 'ERROR: CUSTOMER-NAME IS BLANK'
007000     END-IF.
007100     IF BALANCE < ZERO
007200         MOVE 'Y' TO WS-ERROR-FLAG
007300         DISPLAY 'ERROR: BALANCE IS NEGATIVE'
007400     END-IF.
007500
007600 1300-CALCULATE-TOTALS.
007700     ADD BALANCE TO WS-TOTAL-BALANCE.
007800     ADD 1 TO WS-RECORD-COUNT.
007900     IF WS-RECORD-COUNT > ZERO
008000         DIVIDE WS-TOTAL-BALANCE BY WS-RECORD-COUNT
008100             GIVING WS-AVERAGE-BALANCE
008200     END-IF.
008300
008400 2000-FILE-OPERATIONS SECTION.
008500 2100-OPEN-FILES.
008600     OPEN INPUT INPUT-FILE.
008700     IF FILE-STATUS NOT = '00'
008800         MOVE 'Y' TO WS-ERROR-FLAG
008900         DISPLAY 'ERROR OPENING INPUT FILE'
009000     END-IF.
009100     OPEN OUTPUT OUTPUT-FILE.
009200     IF FILE-STATUS NOT = '00'
009300         MOVE 'Y' TO WS-ERROR-FLAG
009400         DISPLAY 'ERROR OPENING OUTPUT FILE'
009500     END-IF.
009600
009700 2200-READ-RECORD.
009800     READ INPUT-FILE INTO INPUT-RECORD.
009900     IF FILE-STATUS = '10'
010000         MOVE 'Y' TO WS-EOF-FLAG
010100     ELSE IF FILE-STATUS NOT = '00'
010200         MOVE 'Y' TO WS-ERROR-FLAG
010300         DISPLAY 'ERROR READING INPUT FILE'
010400     END-IF.
010500
010600 2300-WRITE-RECORD.
010700     WRITE OUTPUT-RECORD FROM INPUT-RECORD.
010800     IF FILE-STATUS NOT = '00'
010900         MOVE 'Y' TO WS-ERROR-FLAG
011000         DISPLAY 'ERROR WRITING OUTPUT FILE'
011100     END-IF.
011200
011300 2400-CLOSE-FILES.
011400     CLOSE INPUT-FILE.
011500     CLOSE OUTPUT-FILE.
011600
011700 3000-DATA-PROCESSING SECTION.
011800 3100-PROCESS-RECORDS.
011900     PERFORM 2200-READ-RECORD.
012000     PERFORM UNTIL WS-EOF-FLAG = 'Y'
012100         PERFORM 3200-PROCESS-SINGLE-RECORD
012200         PERFORM 2200-READ-RECORD
012300     END-PERFORM.
012400
012500 3200-PROCESS-SINGLE-RECORD.
012600     PERFORM 1200-VALIDATE-INPUT.
012700     IF WS-ERROR-FLAG = 'N'
012800         PERFORM 3300-TRANSFORM-DATA
012900         PERFORM 1300-CALCULATE-TOTALS
013000         PERFORM 2300-WRITE-RECORD
013100     ELSE
013200         PERFORM 9000-ERROR-HANDLER
013300     END-IF.
013400
013500 3300-TRANSFORM-DATA.
013600     MOVE CUSTOMER-ID TO CUSTOMER-ID OF OUTPUT-RECORD.
013700     MOVE CUSTOMER-NAME TO CUSTOMER-NAME OF OUTPUT-RECORD.
013800     MOVE BALANCE TO BALANCE OF OUTPUT-RECORD.
013900     IF BALANCE > 10000
014000         MOVE 'H' TO STATUS-CODE
014100     ELSE IF BALANCE > 5000
014200         MOVE 'M' TO STATUS-CODE
014300     ELSE
014400         MOVE 'L' TO STATUS-CODE
014500     END-IF.
014600
014700 3400-BATCH-PROCESSING.
014800     PERFORM 3100-PROCESS-RECORDS.
014900     PERFORM 3500-GENERATE-SUMMARY.
015000
015100 3500-GENERATE-SUMMARY.
015200     DISPLAY 'TOTAL RECORDS PROCESSED: ' WS-RECORD-COUNT.
015300     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
015400     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
015500
015600 4000-VALIDATION SECTION.
015700 4100-VALIDATE-CUSTOMER-DATA.
015800     IF CUSTOMER-ID = SPACES
015900         MOVE 'Y' TO WS-ERROR-FLAG
016000     END-IF.
016100     IF CUSTOMER-NAME = SPACES
016200         MOVE 'Y' TO WS-ERROR-FLAG
016300     END-IF.
016400
016500 4200-VALIDATE-BALANCE.
016600     IF BALANCE < ZERO
016700         MOVE 'Y' TO WS-ERROR-FLAG
016800     END-IF.
016900     IF BALANCE > 999999999
017000         MOVE 'Y' TO WS-ERROR-FLAG
017100     END-IF.
017200
017300 4300-VALIDATE-FILE-STATUS.
017400     IF FILE-STATUS NOT = '00' AND FILE-STATUS NOT = '10'
017500         MOVE 'Y' TO WS-ERROR-FLAG
017600     END-IF.
017700
017800 5000-REPORTING SECTION.
017900 5100-GENERATE-REPORT.
018000     DISPLAY '=== CUSTOMER PROCESSING REPORT ==='.
018100     DISPLAY 'PROGRAM: SAMPLE-PROGRAM'.
018200     DISPLAY 'DATE: ' FUNCTION CURRENT-DATE.
018300     DISPLAY 'RECORDS PROCESSED: ' WS-RECORD-COUNT.
018400     DISPLAY 'TOTAL BALANCE: ' WS-TOTAL-BALANCE.
018500     DISPLAY 'AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
018600
018700 5200-DISPLAY-ERRORS.
018800     IF WS-ERROR-FLAG = 'Y'
018900         DISPLAY 'ERRORS OCCURRED DURING PROCESSING'
019000     ELSE
019100         DISPLAY 'PROCESSING COMPLETED SUCCESSFULLY'
019200     END-IF.
019300
019400 5300-FORMAT-OUTPUT.
019500     MOVE WS-RECORD-COUNT TO WS-TEMP-VALUE.
019600     DISPLAY 'FORMATTED RECORD COUNT: ' WS-TEMP-VALUE.
019700     MOVE WS-TOTAL-BALANCE TO WS-TEMP-VALUE.
019800     DISPLAY 'FORMATTED TOTAL BALANCE: ' WS-TEMP-VALUE.
019900
020000 6000-UTILITY SECTION.
020100 6100-CLEAR-WORKING-STORAGE.
020200     MOVE ZERO TO WS-RECORD-COUNT.
020300     MOVE ZERO TO WS-TOTAL-BALANCE.
020400     MOVE ZERO TO WS-AVERAGE-BALANCE.
020500     MOVE 'N' TO WS-EOF-FLAG.
020600     MOVE 'N' TO WS-ERROR-FLAG.
020700
020800 6200-INITIALIZE-COUNTERS.
020900     MOVE ZERO TO WS-RECORD-COUNT.
021000     MOVE ZERO TO WS-TOTAL-BALANCE.
021100     MOVE ZERO TO WS-AVERAGE-BALANCE.
021200
021300 6300-RESET-FLAGS.
021400     MOVE 'N' TO WS-EOF-FLAG.
021500     MOVE 'N' TO WS-ERROR-FLAG.
021600
021700 6400-SET-DEFAULTS.
021800     MOVE 'L' TO STATUS-CODE.
021900     MOVE SPACES TO CUSTOMER-ID.
022000     MOVE SPACES TO CUSTOMER-NAME.
022100     MOVE ZERO TO BALANCE.
022200
022300 7000-DISPLAY-RESULTS.
022400     DISPLAY 'PROGRAM COMPLETED'.
022500     DISPLAY 'FINAL RECORD COUNT: ' WS-RECORD-COUNT.
022600     DISPLAY 'FINAL TOTAL BALANCE: ' WS-TOTAL-BALANCE.
022700     DISPLAY 'FINAL AVERAGE BALANCE: ' WS-AVERAGE-BALANCE.
022800
022900 8000-CLOSE-FILES.
023000     CLOSE INPUT-FILE.
023100     CLOSE OUTPUT-FILE.
023200
023300 9000-ERROR-HANDLER.
023400     DISPLAY 'ERROR OCCURRED IN PROGRAM'.
023500     DISPLAY 'ERROR FLAG: ' WS-ERROR-FLAG.
023600     DISPLAY 'EOF FLAG: ' WS-EOF-FLAG.
023700     DISPLAY 'RECORD COUNT: ' WS-RECORD-COUNT.
023800
023900 9100-LOG-ERROR.
024000     DISPLAY 'ERROR LOGGED'.
024100     DISPLAY 'ERROR TYPE: FILE OPERATION'.
024200     DISPLAY 'ERROR TIME: ' FUNCTION CURRENT-DATE.
024300
024400 9200-RECOVERY-PROCEDURE.
024500     MOVE 'N' TO WS-ERROR-FLAG.
024600     PERFORM 6100-CLEAR-WORKING-STORAGE.
024700     DISPLAY 'RECOVERY PROCEDURE COMPLETED'.
024800
024900 9300-CLEANUP-ON-ERROR.
025000     PERFORM 8000-CLOSE-FILES.
025100     PERFORM 6100-CLEAR-WORKING-STORAGE.
025200     DISPLAY 'CLEANUP COMPLETED'.
025300
025400 9400-EXIT-PROGRAM.
025500     DISPLAY 'EXITING PROGRAM'.
025600     STOP RUN.
025700
025800 9500-FINAL-VALIDATION.
025900     IF WS-RECORD-COUNT = ZERO
026000         DISPLAY 'WARNING: NO RECORDS PROCESSED'
026100     END-IF.
026200     IF WS-TOTAL-BALANCE = ZERO
026300         DISPLAY 'WARNING: TOTAL BALANCE IS ZERO'
026400     END-IF.
026500
026600 9600-PERFORMANCE-METRICS.
026700     DISPLAY 'PERFORMANCE METRICS:'.
026800     DISPLAY 'RECORDS PER SECOND: CALCULATED'.
026900     DISPLAY 'MEMORY USAGE: MONITORED'.
027000     DISPLAY 'CPU USAGE: MONITORED'.
027100
027200 9700-SYSTEM-STATUS.
027300     DISPLAY 'SYSTEM STATUS CHECK'.
027400     DISPLAY 'FILE STATUS: ' FILE-STATUS.
027500     DISPLAY 'PROGRAM STATUS: ACTIVE'.
027600
027700 9800-MAINTENANCE-MODE.
027800     DISPLAY 'ENTERING MAINTENANCE MODE'.
027900     DISPLAY 'PERFORMING SYSTEM CHECKS'.
028000     DISPLAY 'MAINTENANCE COMPLETED'.
028100
028200 9900-SHUTDOWN-PROCEDURE.
028300     DISPLAY 'INITIATING SHUTDOWN'.
028400     PERFORM 8000-CLOSE-FILES.
028500     PERFORM 6100-CLEAR-WORKING-STORAGE.
028600     DISPLAY 'SHUTDOWN COMPLETED'.
028700     STOP RUN.